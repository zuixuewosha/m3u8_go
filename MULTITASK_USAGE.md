# M3U8下载器多任务功能使用说明

## 功能介绍

M3U8下载器现在支持多任务下载功能，用户可以同时添加和管理多个下载任务，并在界面上实时查看每个任务的状态、进度、下载速度和剩余时间。

## 界面说明

### 主界面布局

1. **M3U8链接输入框** - 输入要下载的M3U8链接
2. **下载位置选择** - 选择文件保存目录
3. **线程数设置** - 设置下载线程数（1-50）
4. **重试次数设置** - 设置下载失败重试次数（0-20）
5. **自动合并选项** - 下载完成后自动合并TS片段
6. **添加下载任务按钮** - 将当前配置添加为下载任务
7. **合并TS片段按钮** - 手动合并已下载的TS片段
8. **下载任务列表** - 显示所有下载任务的状态信息
9. **任务操作按钮** - 开始、停止、移除选中的任务
10. **下载日志** - 显示详细的下载日志信息
11. **状态栏** - 显示当前操作状态

### 任务列表列说明

- **状态** - 任务当前状态（等待中、下载中、已暂停、已完成、已失败、已停止）
- **进度** - 下载进度百分比
- **速度** - 当前下载速度
- **剩余时间** - 预计剩余下载时间

## 使用方法

### 添加下载任务

1. 在"M3U8链接"输入框中输入有效的M3U8链接
2. 点击"浏览"按钮选择下载保存位置
3. 根据需要调整线程数和重试次数
4. 选择是否启用"下载完成后自动合并TS片段"
5. 点击"添加下载任务"按钮

添加成功后，任务会显示在"下载任务列表"中，状态为"等待中"。

### 管理下载任务

#### 开始任务
1. 在任务列表中选择要开始的任务
2. 点击"开始任务"按钮
3. 任务状态将变为"下载中"，开始下载TS片段

#### 停止任务
1. 在任务列表中选择正在下载的任务
2. 点击"停止任务"按钮
3. 任务状态将变为"已停止"

#### 移除任务
1. 在任务列表中选择任意任务
2. 点击"移除任务"按钮
3. 任务将从列表中移除

### 查看任务详情

在任务列表中，可以实时查看每个任务的：
- 当前状态
- 下载进度百分比
- 下载速度
- 预计剩余时间

### 查看下载日志

在"下载日志"区域可以查看详细的下载信息，包括：
- 任务添加记录
- 下载进度更新
- 错误信息
- 合并操作日志

## 技术实现

### 任务管理器

多任务功能通过`task_manager.py`模块实现，主要包含：

1. **TaskStatus枚举** - 定义任务状态
2. **DownloadTask数据类** - 存储任务信息
3. **TaskManager类** - 管理所有下载任务

### 核心功能

1. **任务添加** - `add_task()`方法
2. **状态更新** - `update_task_status()`方法
3. **进度更新** - `update_task_progress()`方法
4. **错误处理** - `set_task_error()`方法
5. **任务移除** - `remove_task()`方法
6. **监听器机制** - 实现UI实时更新

## 注意事项

1. **线程数设置** - 过高的线程数可能导致网络拥塞或服务器拒绝服务
2. **存储空间** - 确保有足够的磁盘空间存储下载的TS片段
3. **网络稳定性** - 不稳定的网络连接可能影响下载速度和成功率
4. **任务数量** - 同时运行过多任务可能影响系统性能
5. **自动合并** - 启用自动合并会在下载完成后立即执行合并操作

## 常见问题

### 任务状态长时间为"等待中"
- 检查是否已点击"开始任务"按钮
- 确认任务未被其他操作阻塞

### 下载速度慢
- 尝试增加线程数
- 检查网络连接状态
- 确认服务器带宽限制

### 任务失败
- 查看下载日志中的错误信息
- 检查M3U8链接是否有效
- 确认下载目录是否有写入权限

### 无法合并TS片段
- 确认所有TS片段已下载完成
- 检查FFmpeg是否正确安装
- 确认输出文件路径是否有写入权限