# M3U8链接解析下载工具

这是一个简单的图形界面工具，用于解析和下载M3U8流媒体链接中的视频片段。

![界面预览](界面预览.png)

## 项目结构

```
m3u8_downloader/
├── main.py             # 主程序文件
├── icon.py             # 图标文件
├── merge_ts.py         # TS片段合并工具
├── merge.bat           # 合并工具Windows批处理文件
├── task_manager.py     # 多任务管理器
├── requirements.txt    # 依赖列表
├── start.bat           # 启动批处理文件
├── README.md           # 说明文档
├── USAGE.md            # 使用说明
├── HELP.md             # 帮助文档
├── VERSION             # 版本信息
└── sample.m3u8         # 示例M3U8文件
```

## 功能特点

- 图形化界面，易于操作
- 支持自定义下载线程数
- 可配置重试次数
- 支持选择下载位置
- 实时显示下载进度和日志
- 支持停止下载功能
- **支持多个下载任务同时管理**
- **在界面中显示多个下载任务的状态、进度、速度和剩余时间**
- **提供任务操作功能：开始、停止、移除任务**
- **支持断点续传功能，程序重启后可继续未完成的下载任务**

## 安装依赖

在运行程序之前，请确保安装了所需的依赖包：

```bash
pip install -r requirements.txt
```

## 使用方法

### 方法一：使用批处理文件（推荐）
双击运行 `start.bat` 文件

### 方法二：命令行运行
```bash
python main.py
```

## 界面说明

1. **M3U8链接/文件**：输入要下载的M3U8链接地址或选择本地M3U8文件
2. **选择文件**：点击此按钮可以选择本地的M3U8文件
3. **下载位置**：选择文件保存的目录
4. **线程数**：设置同时下载的线程数量（1-50）
5. **重试次数**：设置下载失败时的重试次数（0-20）
6. **开始下载/停止下载**：开始或停止下载任务
7. **下载日志**：显示详细的下载过程信息

## 使用步骤

1. 在"M3U8链接"输入框中粘贴M3U8链接
2. 点击"浏览"按钮选择下载位置
3. 根据需要调整线程数和重试次数
4. 点击"开始下载"按钮开始下载
5. 下载过程中可以随时点击"停止下载"来中断任务

## 注意事项

- 请确保网络连接稳定
- 某些网站可能有防盗链机制，可能需要额外处理
- 下载的TS片段需要手动合并为完整视频文件
- 线程数不是越多越好，过多的线程可能导致服务器拒绝连接
- 如果遇到下载失败，可以适当增加重试次数

## 合并TS片段（可选）

下载完成后，可以使用以下方法将TS片段合并为完整视频文件：

### 方法一：使用自动化合并工具（推荐）
项目提供了一个自动化合并工具 `merge_ts.py`，可以自动检测下载的TS片段并合并为完整视频：

```bash
python merge_ts.py -d 下载目录 -o output.mp4
```

参数说明：
- `-d` 或 `--directory`: TS片段所在的目录（默认为当前目录）
- `-o` 或 `--output`: 输出文件名（默认为output.mp4）
- `-m` 或 `--method`: 合并方法（ffmpeg或copy，默认自动选择）

### 方法二：使用FFmpeg命令行
```bash
# Windows/Linux/Mac通用方法
ffmpeg -f concat -safe 0 -i file_list.txt -c copy output.mp4
```

其中file_list.txt内容格式为：
```
file 'segment_00001.ts'
file 'segment_00002.ts'
file 'segment_00003.ts'
...
```

### 方法三：使用原始FFmpeg命令
```bash
# Windows (使用FFmpeg)
ffmpeg -i "concat:segment_00001.ts|segment_00002.ts|..." -c copy output.mp4

# Linux/Mac (使用FFmpeg)
ls segment_*.ts | sort -V | xargs printf "file '%s'\n" | ffmpeg -f concat -i - -c copy output.mp4
```

## 常见问题

### 1. 下载速度慢
- 尝试增加线程数
- 检查网络连接
- 检查目标服务器是否限速

### 2. 下载失败
- 增加重试次数
- 检查M3U8链接是否有效
- 检查是否有防盗链机制

### 3. 程序无法启动
- 确保已安装所有依赖
- 检查Python环境是否正确

## 技术说明

- 使用Python + Tkinter开发图形界面
- 使用requests库进行网络请求
- 支持多线程下载以提高速度
- 具备断点续传和重试机制
- 任务状态持久化，程序重启后可恢复未完成的下载任务
- 支持部分下载文件的恢复，避免重复下载已下载的内容

## 开源协议

本项目仅供学习交流使用，请勿用于商业用途。